# -*- coding: utf-8 -*-
"""Mumbai_House Predection.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1jphWOp1fmvAxUOncx39ndyHhWkj5gili
"""

# Drive mount
from google.colab import drive
drive.mount('/content/drive')

filepath = "/content/drive/MyDrive/Machine Learning With Python/mumbai-house-price-data-cleaned.csv"

import pandas as pd

data = pd.read_csv(filepath)

data.head(5)

# To check the shape
data.shape

# Check the name of columns
data.columns

data.info()

data.describe()

data.isna().sum()

data = data.dropna()

data.shape

data["area"].unique()

data["city"].unique()

data["city"].value_counts()

data["area"].value_counts()

# Duplicates count
data.duplicated().sum()

# Dropping duplicates
data = data.drop_duplicates()



data["area"].unique()

data["property_type"] =data["property_type"].str.lower()

data["title"]= data["title"].str.strip()

data["property_type"].unique()

data["city"]= data["city"].str.lower()

replace_pro = {
    "apartment":"Apartment",
    "villa":"Villa",
    "independent house": "Independent House"
}

data["property_type"]= data["property_type"].replace(replace_pro)

"""# Data Visualization

# Univariate analysis
"""

import matplotlib.pyplot as plt
import seaborn as sns

sns.histplot(data["price"],color = "yellow")
plt.title("Price Distribution")
plt.show()

sns.histplot(data["age"],color = "red")
plt.title("Age Distribution")
plt.show()

data["age"].unique()

data = data[(data["age"]>16) & (data["age"]<60)]

sns.histplot(data["latitude"],color = "purple",bins = 20, kde= True)
plt.title("Latitude")
plt.show()

sns.countplot(data["city"], color="green")
plt.title("coutplot of city")
plt.show()

sns.boxplot(data["age"],color="skyblue")
plt.show()

"""# Bivariate analysis"""

# scatterplot
sns.scatterplot(data=data, x="price_per_sqft", y ="price")
plt.title("scatterplot between price per sqft and price")
plt.show()

sns.scatterplot(data=data, x="age", y ="price")
plt.title("scatterplot between age and price")
plt.show()

# label encoding
from sklearn.preprocessing import LabelEncoder

#le = LabelEncoder()
#data["property_type"] = le.fit_transform(data["property_type"])

label_encoder = {}
for col in data.select_dtypes(include="object"):
  le = LabelEncoder()
  data[col] = le.fit_transform(data[col])
  label_encoder[col] = le

data.info()

sns.heatmap(data.corr(),annot = True ,
            cmap="Blues")
plt.show()

data.skew(numeric_only=True)

# splitting data into features and target variable
x = data.drop("price",axis=1) # features
y = data["price"] # target variable

# splitting in train and test data
from sklearn.model_selection import train_test_split

x_train,x_test,y_train,y_test = train_test_split(x,y,test_size=0.2,random_state=42)

# linear regression

from sklearn.linear_model import LinearRegression
lr = LinearRegression()
lr.fit(x_train,y_train)

y_pred_lr = lr.predict(x_test)

# r2 score
from sklearn.metrics import r2_score

r2_lr = r2_score(y_test,y_pred_lr)
print(r2_lr)

# decision tree regressor
from sklearn.tree import DecisionTreeRegressor
dtr = DecisionTreeRegressor()
dtr.fit(x_train,y_train)

y_pred_dtr = dtr.predict(x_test)

r2_dtr = r2_score(y_test,y_pred_dtr)

print(r2_dtr)

# randomforest regressor
from sklearn.ensemble import RandomForestRegressor
rfr = RandomForestRegressor()
rfr.fit(x_train,y_train)

y_pred_rfr = rfr.predict(x_test)

r2_rfr = r2_score(y_test,y_pred_rfr)
print(r2_rfr)

# downloading the model
import joblib
joblib.dump(rfr,"mumbai_house_model.pkl")

# download in system
from google.colab import files
files.download("mumbai_house_model.pkl")

# label encoder
joblib.dump(label_encoder,"label_encoder.pkl")
files.download("label_encoder.pkl")

import streamlit as st
import pandas as pd
import joblib

# Load trained pipeline model
model = joblib.load("mumbai_house_model.pkl")
encoder = joblib.load("label_encoder.pkl")

st.title("Mumbai House Price Prediction")

st.write("Enter property details")

area = st.number_input("Area (sqft)", 200, 5000)
bedrooms = st.number_input("Bedrooms", 1, 10)
bathrooms = st.number_input("Bathrooms", 1, 10)
parking = st.number_input("Parking Spaces", 0, 5)

location = st.selectbox(
    "Location",
    [
        "Andheri West",
        "Bandra",
        "Borivali",
        "Thane",
        "Navi Mumbai"
    ]
)

# Create dataframe
df = pd.DataFrame({
    "area": [area],
    "bedrooms": [bedrooms],
    "bathrooms": [bathrooms],
    "parking": [parking],
    "location": [location]
})

if st.button("Predict Price"):
    prediction = model.predict(df)
    st.success(f"Estimated Price: â‚¹ {prediction[0]:,.2f}")
